apiVersion: v1
kind: ConfigMap
metadata:
  name: haproxy-config
  namespace: haproxy
  annotations:
    kapp.k14s.io/versioned: ""
data:
  haproxy.cfg: |
    global
      log stdout format raw local0
      maxconn 4096
      user haproxy
      group haproxy
      daemon
    
    # ACL definitions for log filtering from specific IP ranges

    defaults
      log     global
      mode    tcp
      option  dontlognull
      timeout connect 5s
      timeout client  50s
      timeout server  50s
    
    # Common log filtering settings

    # LDAPS routing (636) - to be implemented later
    # frontend ldaps_frontend
    #   bind *:636
    #   mode tcp
    #   option tcplog
    #   
    #   # Using simpler approach for log filtering
    #   # Option 1: Turn off logging completely for this frontend
    #   no log
    #   
    #   default_backend ldaps_backend
    #
    # backend ldaps_backend
    #   mode tcp
    #   server openldap openldap-stack-ha.openldap.svc.cluster.local:636 check

    # Minecraft/Cloudflared routing (25565)
    frontend minecraft_frontend
      bind *:25565
      mode tcp
      option tcplog
    
      # Using simpler approach for log filtering
      # Option 1: Turn off logging completely for this frontend
      no log
    
      default_backend minecraft_backend
    
    backend minecraft_backend
      mode tcp
      server cloudflared cloudflared.cloudflared.svc.cluster.local:25565 check


