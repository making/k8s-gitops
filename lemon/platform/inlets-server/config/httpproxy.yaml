#@ for name in ['synology', 'inlets.gw', 'openai.synology', 's3.synology']:
---
apiVersion: projectcontour.io/v1
kind: HTTPProxy
metadata:
  name: #@ name.replace('.', '-')
  namespace: inlets
spec:
  virtualhost:
    fqdn: #@ "{}.ik.am".format(name)
    tls:
      secretName: projectcontour/default-tls-ik-am
    #@ if name == 'openai.synology':
    authorization:
      extensionRef:
        name: envoy-external-authz
        namespace: projectcontour
    #@ end
  routes:
  - services:
    - name: inlets-exit
      port: 6868
    enableWebsockets: true
    timeoutPolicy:
      response: 300s
#@ end