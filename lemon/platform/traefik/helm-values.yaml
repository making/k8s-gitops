service:
  type: ClusterIP
deployment:
  replicas: 2
ports:
  web:
    proxyProtocol:
      trustedIPs:
      - 10.0.0.0/16
      - 10.96.0.0/16
    transport:
      respondingTimeouts:
        readTimeout: 600s
        writeTimeout: 600s
        idleTimeout: 600s
  websecure:
    proxyProtocol:
      trustedIPs:
      - 10.0.0.0/16
      - 10.96.0.0/16
    transport:
      respondingTimeouts:
        readTimeout: 600s
        writeTimeout: 600s
        idleTimeout: 600s
    middlewares:
    - traefik-denyip@kubernetescrd
logs:
  general:
    format: json
    #! level: WARN
  access:
    enabled: true
    format: json
    otlp:
      enabled: true
      http:
        enabled: true
        endpoint: http://otel-collector.opentelemetry.svc.cluster.local:4318/v1/logs
        tls:
          insecureSkipVerify: true
tracing:
  otlp:
    enabled: true
    http:
      enabled: true
      endpoint: http://otel-collector.opentelemetry.svc.cluster.local:4318/v1/traces
      tls:
        insecureSkipVerify: true
experimental:
  plugins:
    denyip:
      moduleName: "github.com/kvncrw/denyip"
      version: "v1.1.0"
    coraza:
      moduleName: "github.com/jcchavezs/coraza-http-wasm-traefik"
      version: "v0.3.0"
  otlpLogs: true
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`dashboard.traefik.ik.am`)
    entryPoints:
    - websecure
    middlewares:
    - name: dashboard-auth
    tls:
      secretName: dashboard-tls
extraObjects:
- apiVersion: cert-manager.io/v1
  kind: Certificate
  metadata:
    name: dashboard-tls
    namespace: traefik
  spec:
    secretName: dashboard-tls
    issuerRef:
      name: letsencrypt
      kind: ClusterIssuer
    dnsNames:
    - dashboard.traefik.ik.am
- apiVersion: v1
  kind: Secret
  metadata:
    name: dashboard-auth-secret
    namespace: traefik
  type: kubernetes.io/basic-auth
  stringData:
    username: admin
    password: changeme
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: dashboard-auth
    namespace: traefik
  spec:
    basicAuth:
      secret: dashboard-auth-secret
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: denyip
    namespace: traefik
  spec:
    plugin:
      denyip:
        ipDenyList:
        - 104.197.69.115
        - 13.56.149.3
        - 147.185.132.76
        - 157.143.20.83
        - 157.143.30.12
        - 159.89.194.131
        - 164.92.107.174
        - 172.192.18.188
        - 185.242.177.0/24
        - 192.159.99.95
        - 193.142.147.209
        - 195.178.110.201
        - 198.235.24.152
        - 205.169.39.0/24
        - 3.233.59.216
        - 34.123.170.104
        - 37.46.196.22
        - 74.7.0.0/16
        - 78.153.140.171
        - 79.100.14.146
        - 91.239.216.99
        - 95.214.52.170
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: coraza
    namespace: traefik
  spec:
    plugin:
      coraza:
        directives:
        - SecRuleEngine On
        - SecDebugLog /dev/stdout
        - SecDebugLogLevel 9
        - SecRule REQUEST_URI "@streq /wp-admin" "id:101,phase:1,log,deny,status:403"
        - Include @crs-setup.conf.example
        - Include @owasp_crs/*.conf
